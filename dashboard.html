<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vendor Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .dashboard-container {
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }

    body {
  background: url('images/chatbot_bg.png') repeat;
  background-size: 300px auto;
  background-color: #fff7f0;
  background-attachment: fixed;
}


    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-top: 24px;
    }

    th, td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid #f0f0f0;
    }

    th {
      background: #ff7a00;
      color: white;
    }

    tr:hover {
      background-color: #fff2e6;
    }

    .rating {
      color: #ff7a00;
      font-weight: 500;
    }

    #user-email {
      margin-bottom: 10px;
      font-weight: 500;
    }

    /* Chatbot styles */
    #chatbot-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #ff7a00;
      color: white;
      border: none;
      border-radius: 50px;
      padding: 12px 18px;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      z-index: 1000;
    }

    #chatbot-panel {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100%;
      background: white;
      border-left: 1px solid #eee;
      box-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);
      transition: right 0.3s ease;
      z-index: 999;
      display: flex;
      flex-direction: column;
    }

    #chatbot-panel.open {
      right: 0;
    }

    #chatbot-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #ff7a00;
      color: white;
      padding: 12px 16px;
      font-size: 1rem;
    }

    #chatbot-iframe {
      flex: 1;
      width: 100%;
      border: none;
    }

    #chatbot-close {
      background: transparent;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
    }

   h2 {
  text-align: center;
  font-size: 1.4rem;
  font-weight: 600;
  margin-top: 24px;
  margin-bottom: 8px;
  padding: 10px 16px;
  background: rgba(255, 255, 255, 0.75);
  color: #333;
  display: inline-block;
  border-radius: 10px;
}

.feedback-box {
  margin: 40px auto;
  max-width: 600px;
  padding: 20px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  text-align: center;
}

.feedback-box h3 {
  margin-bottom: 10px;
  color: #333;
}

.feedback-box textarea {
  width: 100%;
  height: 100px;
  padding: 12px;
  border: 1px solid #ccc;
  border-radius: 8px;
  resize: none;
  font-size: 1rem;
  margin-bottom: 10px;
  outline: none;
}

.feedback-box textarea:focus {
  border-color: #ff7a00;
}

#feedback-msg {
  margin-top: 10px;
  font-size: 0.9rem;
  color: green;
}
textarea {
  width: 100%;
  max-width: 500px;
  padding: 12px;
  margin: 12px auto;
  border: 2px solid #ff7a00;
  border-radius: 8px;
  font-size: 1rem;
  resize: vertical;
  display: block;
}

@media (max-width: 768px) {
  header {
    flex-direction: column;
    align-items: flex-start;
    padding: 12px 16px;
  }

  #user-email {
    margin: 8px 0;
  }

  .dashboard-container {
    padding: 12px;
  }

  table {
    font-size: 0.85rem;
  }

  th, td {
    padding: 8px 10px;
  }

  .feedback-box {
    padding: 12px;
    margin-top: 24px;
  }

  .feedback-box textarea {
    font-size: 0.9rem;
    padding: 10px;
  }

  .orange-btn {
    width: 100%;
    font-size: 0.95rem;
    padding: 10px;
  }

  #chatbot-btn {
    right: 16px;
    bottom: 16px;
    font-size: 1rem;
    padding: 10px 12px;
  }

  iframe#chatbot-iframe {
    height: 80vh;
  }
}

  </style>
</head>

<body>
  <header style="display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; border-bottom: 1px solid #eee; background: white;">
    <h1 style="margin: 0; color: #ff7a00;">Vendor Assist ðŸ§¡</h1>
    
    <div>
      <span id="user-email" style="margin-right: 16px; font-weight: 500;"></span>
      <button class="orange-btn" onclick="logout()">Logout</button>
    </div>
  </header>

  <div class="dashboard-container">
  <div style="text-align: center;">
  <h2>ðŸ›’ Our Trusted Vendor Network</h2>
</div>

 <div class="table-wrapper">
    <input 
  type="text" 
  id="search-input" 
  placeholder="Search vendors..." 
  style="margin-top: 20px; padding: 10px; width: 100%; max-width: 400px; border: 2px solid #ff7a00; border-radius: 8px; display: block; margin-left: auto; margin-right: auto;"
/>

    <table id="vendor-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Category</th>
          <th>Location</th>
          <th>Price</th>
          <th>Notes</th>
          <th>Ratings</th>
        </tr>
      </thead>
      <tbody>
        <!-- Vendor rows go here -->
      </tbody>
    </table>
    <div class="feedback-box">
  <h3>ðŸ“£ Suggest a Vendor or Improvement</h3>
  <textarea id="feedback-input" placeholder="Share your thoughts..."></textarea>
  <button class="orange-btn" id="feedback-submit">Submit</button>
  <p id="feedback-msg" style="text-align:center; color: green; display:none;">Thanks for your feedback!</p>
</div>


  </div>
</div>
  <!-- Load CSV parser -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <!-- Vendor data + Supabase auth -->
  <script type="module">
    import { supabase } from './supabase.js';

    async function getUser() {
      const { data: { user }, error } = await supabase.auth.getUser();
      if (error || !user) {
        window.location.href = 'index.html';
      } else {
        document.getElementById('user-email').textContent = `Logged in as: ${user.email}`;
      }
    }

    async function logout() {
      await supabase.auth.signOut();
      window.location.href = 'index.html';
    }

    window.logout = logout;

    getUser();

    // Load vendors from CSV
    Papa.parse("vendors_specific_train.csv", {
      download: true,
      header: true,
      complete: function(results) {
        const tableBody = document.querySelector("#vendor-table tbody");

        results.data.forEach(vendor => {
          const isEmpty = Object.values(vendor).every(val => !val || val.trim() === "");
          if (isEmpty) return;
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${vendor.Name}</td>
            <td>${vendor.Category}</td>
            <td>${vendor.Location}</td>
            <td>${vendor.Price_per_unit}</td>
            <td>${vendor.Notes}</td>
            <td class="rating">${vendor.Ratings}</td>
          `;
          tableBody.appendChild(row);
        });
      }
    });
  document.getElementById("search-input").addEventListener("input", function () {
    const searchValue = this.value.toLowerCase();
    const rows = document.querySelectorAll("#vendor-table tbody tr");

    rows.forEach(row => {
      const text = row.innerText.toLowerCase();
      row.style.display = text.includes(searchValue) ? "" : "none";
    });
  });
</script>


  <!-- Chatbot Button -->
  <button id="chatbot-btn" title="Open Chatbot">ðŸ’¬ Chat</button>

  <!-- Slide-in Chatbot Panel -->
  <div id="chatbot-panel">
    <div id="chatbot-header">
      <span>Vendor Chatbot</span>
      <button id="chatbot-close">âœ–</button>
    </div>
    <iframe 
      src="https://vendor-assist-chatbot.lovable.app" 
      frameborder="0" 
      id="chatbot-iframe"
    ></iframe>
  </div>

  <!-- Toggle chatbot panel -->
  <script>
    const chatbotBtn = document.getElementById('chatbot-btn');
    const chatbotPanel = document.getElementById('chatbot-panel');
    const chatbotClose = document.getElementById('chatbot-close');

    chatbotBtn.addEventListener('click', () => {
      chatbotPanel.classList.add('open');
    });

    chatbotClose.addEventListener('click', () => {
      chatbotPanel.classList.remove('open');
    });
  </script>
  <script>
  document.getElementById("feedback-submit").addEventListener("click", () => {
    const feedback = document.getElementById("feedback-input").value.trim();
    const msg = document.getElementById("feedback-msg");

    if (feedback === "") {
      alert("Please enter feedback before submitting!");
      return;
    }

    // For now, just show a success message (can be sent to Supabase later)
    msg.style.display = "block";

    // Optionally clear the input
    document.getElementById("feedback-input").value = "";

    // Hide the message after 3 seconds
    setTimeout(() => {
      msg.style.display = "none";
    }, 3000);
  });
</script>

</body>
</html>
